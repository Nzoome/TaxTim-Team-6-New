{"ast":null,"code":"import _objectSpread from\"C:/Users/Baloyi PA/Desktop/TaxTim-Team-6-New/TaxTim-Team-6-New/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo,useRef}from'react';import{useNavigate,useLocation}from'react-router-dom';import{BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,PieChart,Pie,Cell}from'recharts';import{getTransactionData,uploadTransactionFile}from'../services/api';import{generatePDF}from'../services/pdfGenerator';import{generateExcel}from'../services/excelGenerator';import'./LandingPage.css';import'./Dashboard.css';import SummaryCards from'./SummaryCards';import TransactionTableEnhanced from'./TransactionTableEnhanced';import Charts from'./Charts';import FilterPanel from'./FilterPanel';import ExportButtons from'./ExportButtons';import SuspiciousTransactionSummary from'./SuspiciousTransactionSummary';import TaxStatusSummary from'./TaxStatusSummary';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LandingPage=()=>{const navigate=useNavigate();const location=useLocation();const fileInputRef=useRef(null);const[searchTerm,setSearchTerm]=useState('');const[loading,setLoading]=useState(true);const[data,setData]=useState(null);const[filters,setFilters]=useState({asset:'all',type:'all',taxYear:'all'});const[uploadState,setUploadState]=useState({isUploading:false,error:null,errors:{},success:false});const[isGeneratingPDF,setIsGeneratingPDF]=useState(false);const[isGeneratingExcel,setIsGeneratingExcel]=useState(false);useEffect(()=>{// Clear cache on initial page load (not on navigation)\nconst clearCacheAndFetch=async()=>{var _location$state;if(!((_location$state=location.state)!==null&&_location$state!==void 0&&_location$state.fromProcessing)){try{await fetch('http://localhost:8000/clear_cache.php',{method:'POST'});}catch(err){console.error('Error clearing cache:',err);}}fetchData();};clearCacheAndFetch();},[location]);// Refetch when location changes (e.g., navigating back)\nconst fetchData=async()=>{try{setLoading(true);const response=await fetch('http://localhost:8000/transactions.php');const result=await response.json();if(result.success){// Enrich transactions with FIFO breakdown data\nif(result.data.transactions&&result.data.analytics&&result.data.analytics.fifo_breakdowns){const enrichedTransactions=result.data.transactions.map((tx,index)=>{const breakdown=result.data.analytics.fifo_breakdowns[index];// Determine the primary currency based on transaction type\nlet primaryCurrency;const txType=(tx.type||'').toUpperCase();if(txType==='BUY'){primaryCurrency=(breakdown===null||breakdown===void 0?void 0:breakdown.currency)||tx.toCurrency;}else if(txType==='SELL'){primaryCurrency=(breakdown===null||breakdown===void 0?void 0:breakdown.currency)||tx.fromCurrency;}else if(txType==='TRADE'){primaryCurrency=(breakdown===null||breakdown===void 0?void 0:breakdown.fromCurrency)||tx.fromCurrency;}else{primaryCurrency=(breakdown===null||breakdown===void 0?void 0:breakdown.currency)||tx.toCurrency||tx.fromCurrency;}return _objectSpread(_objectSpread({},tx),{},{currency:primaryCurrency,amount:(breakdown===null||breakdown===void 0?void 0:breakdown.amount)||tx.toAmount||tx.fromAmount||0,capitalGain:(breakdown===null||breakdown===void 0?void 0:breakdown.capitalGain)||0,proceeds:(breakdown===null||breakdown===void 0?void 0:breakdown.proceeds)||0,costBase:(breakdown===null||breakdown===void 0?void 0:breakdown.costBase)||0,taxYear:(breakdown===null||breakdown===void 0?void 0:breakdown.taxYear)||null,lotsConsumed:(breakdown===null||breakdown===void 0?void 0:breakdown.lotsConsumed)||null});});result.data.transactions=enrichedTransactions;}setData(result.data);}}catch(err){console.error('Error fetching data:',err);}finally{setLoading(false);}};const transactions=(data===null||data===void 0?void 0:data.transactions)||[];// Filter transactions based on dashboard filters\nconst filteredTransactions=useMemo(()=>{if(!data||!data.transactions)return[];return data.transactions.filter(tx=>{// Search filter\nif(searchTerm){const search=searchTerm.toLowerCase();const txString=JSON.stringify(tx).toLowerCase();if(!txString.includes(search))return false;}// Filter by asset\nif(filters.asset!=='all'){if(tx.currency!==filters.asset){return false;}}// Filter by type\nif(filters.type!=='all'){const txType=(tx.type||'').toUpperCase();const filterType=(filters.type||'').toUpperCase();if(txType!==filterType)return false;}// Filter by tax year\nif(filters.taxYear!=='all'&&tx.taxYear!==filters.taxYear){return false;}return true;});},[data,filters,searchTerm]);// Helper function to calculate taxable gain with annual exclusion\nconst calculateTaxableGain=netGain=>{if(netGain<=0)return{taxable:0,exclusionApplied:0,exclusionUsed:false};const ANNUAL_EXCLUSION=40000;const INCLUSION_RATE=0.4;if(netGain>ANNUAL_EXCLUSION){const afterExclusion=netGain-ANNUAL_EXCLUSION;return{taxable:afterExclusion*INCLUSION_RATE,exclusionApplied:ANNUAL_EXCLUSION,exclusionUsed:true};}else{return{taxable:0,exclusionApplied:netGain,exclusionUsed:true};}};// Calculate filtered summary\nconst filteredSummary=useMemo(()=>{// Use analytics data from backend if available\nif(data&&data.analytics){const taxCalc=calculateTaxableGain(data.analytics.capital_gain||0);return{totalProceeds:data.analytics.total_proceeds||0,totalCostBase:data.analytics.total_cost_base||0,totalCapitalGain:data.analytics.total_capital_gain||0,totalCapitalLoss:data.analytics.total_capital_loss||0,netCapitalGain:data.analytics.capital_gain||0,taxableCapitalGain:taxCalc.taxable,annualExclusionApplied:taxCalc.exclusionApplied,annualExclusionUsed:taxCalc.exclusionUsed,transactionsProcessed:data.analytics.transactions_processed||0};}if(!filteredTransactions.length){return{totalProceeds:0,totalCostBase:0,totalCapitalGain:0,totalCapitalLoss:0,netCapitalGain:0,taxableCapitalGain:0,annualExclusionApplied:0,annualExclusionUsed:false,transactionsProcessed:0};}const summary=filteredTransactions.reduce((acc,tx)=>{if(tx.type==='SELL'||tx.type==='TRADE_SELL'){acc.totalProceeds+=tx.proceeds||0;acc.totalCostBase+=tx.costBase||0;const gain=tx.capitalGain||0;if(gain>=0){acc.totalCapitalGain+=gain;}else{acc.totalCapitalLoss+=Math.abs(gain);}acc.netCapitalGain+=gain;}acc.transactionsProcessed++;return acc;},{totalProceeds:0,totalCostBase:0,totalCapitalGain:0,totalCapitalLoss:0,netCapitalGain:0,transactionsProcessed:0});const taxCalc=calculateTaxableGain(summary.netCapitalGain);summary.taxableCapitalGain=taxCalc.taxable;summary.annualExclusionApplied=taxCalc.exclusionApplied;summary.annualExclusionUsed=taxCalc.exclusionUsed;return summary;},[data,filteredTransactions]);// Calculate unfiltered summary for charts (all assets, all transactions)\nconst unfilteredSummary=useMemo(()=>{// Use analytics data from backend if available\nif(data&&data.analytics){const taxCalc=calculateTaxableGain(data.analytics.capital_gain||0);return{totalProceeds:data.analytics.total_proceeds||0,totalCostBase:data.analytics.total_cost_base||0,totalCapitalGain:data.analytics.total_capital_gain||0,totalCapitalLoss:data.analytics.total_capital_loss||0,netCapitalGain:data.analytics.capital_gain||0,taxableCapitalGain:taxCalc.taxable,annualExclusionApplied:taxCalc.exclusionApplied,annualExclusionUsed:taxCalc.exclusionUsed,transactionsProcessed:data.analytics.transactions_processed||0};}if(!transactions.length){return{totalProceeds:0,totalCostBase:0,totalCapitalGain:0,totalCapitalLoss:0,netCapitalGain:0,taxableCapitalGain:0,annualExclusionApplied:0,annualExclusionUsed:false,transactionsProcessed:0};}const summary=transactions.reduce((acc,tx)=>{if(tx.type==='SELL'||tx.type==='TRADE_SELL'){acc.totalProceeds+=tx.proceeds||0;acc.totalCostBase+=tx.costBase||0;const gain=tx.capitalGain||0;if(gain>=0){acc.totalCapitalGain+=gain;}else{acc.totalCapitalLoss+=Math.abs(gain);}acc.netCapitalGain+=gain;}acc.transactionsProcessed++;return acc;},{totalProceeds:0,totalCostBase:0,totalCapitalGain:0,totalCapitalLoss:0,netCapitalGain:0,transactionsProcessed:0});const taxCalc=calculateTaxableGain(summary.netCapitalGain);summary.taxableCapitalGain=taxCalc.taxable;summary.annualExclusionApplied=taxCalc.exclusionApplied;summary.annualExclusionUsed=taxCalc.exclusionUsed;return summary;},[data,transactions]);// Extract unique tax years from data\nconst taxYears=useMemo(()=>{if(!data||!data.transactions)return[];const years=new Set();data.transactions.forEach(tx=>{if(tx.taxYear)years.add(tx.taxYear);});return Array.from(years).sort();},[data]);// Extract unique assets\nconst assets=useMemo(()=>{if(!data||!data.transactions)return[];const assetSet=new Set();data.transactions.forEach(tx=>{if(tx.currency)assetSet.add(tx.currency);if(tx.fromCurrency)assetSet.add(tx.fromCurrency);if(tx.toCurrency)assetSet.add(tx.toCurrency);});return Array.from(assetSet).sort();},[data]);const handleFilterChange=newFilters=>{setFilters(newFilters);};// Get unique currencies for filter dropdown (for sidebar)\nconst currencies=assets;// Check if we have any transactions\nconst hasTransactions=data&&data.transactions&&data.transactions.length>0;const handleUploadClick=()=>{// Trigger file input click instead of navigating\nif(fileInputRef.current){fileInputRef.current.click();}};const handleFileChange=async e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(!file)return;// Validate file type\nconst validTypes=['text/csv','application/vnd.ms-excel','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];if(!validTypes.includes(file.type)&&!file.name.endsWith('.csv')&&!file.name.endsWith('.xlsx')&&!file.name.endsWith('.xls')){setUploadState({isUploading:false,error:'Please upload a CSV or XLSX file',errors:{},success:false});return;}// Start upload\nsetUploadState({isUploading:true,error:null,errors:{},success:false});try{const response=await uploadTransactionFile(file);if(response.success){// Keep showing the processing message for 1.5 seconds before showing success\nsetTimeout(async()=>{setUploadState({isUploading:false,error:null,errors:{},success:true});// Refresh data after successful upload\nawait fetchData();// Clear success message after 3 seconds\nsetTimeout(()=>{setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{success:false}));},3000);},1500);}else{setUploadState({isUploading:false,error:response.error||'An error occurred during upload',errors:response.errors||{},success:false});}}catch(err){setUploadState({isUploading:false,error:err.error||'Failed to process file',errors:err.errors||{},success:false});}// Reset file input\nif(fileInputRef.current){fileInputRef.current.value='';}};const handleResetFilters=()=>{setFilters({asset:'all',type:'all',taxYear:'all'});setSearchTerm('');};const handlePDFDownload=async()=>{setIsGeneratingPDF(true);try{await generatePDF(filteredTransactions,filteredSummary,filters);}catch(error){console.error('Error generating PDF:',error);alert('Failed to generate PDF. Please try again.');}finally{setIsGeneratingPDF(false);}};const handleExcelDownload=async()=>{setIsGeneratingExcel(true);try{await generateExcel(filteredTransactions,filteredSummary,filters);}catch(error){console.error('Error generating Excel:',error);alert('Failed to generate Excel file. Please try again.');}finally{setIsGeneratingExcel(false);}};const handleRestart=async()=>{try{// Clear the cache\nawait fetch('http://localhost:8000/clear_cache.php',{method:'POST'});// Clear session storage\nsessionStorage.removeItem('justProcessedFile');// Reload the page\nwindow.location.reload();}catch(err){console.error('Error restarting:',err);// Reload anyway\nwindow.location.reload();}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"landing-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading dashboard...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"landing-page\",children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\".csv,.xlsx,.xls\",onChange:handleFileChange,style:{display:'none'}}),(uploadState.isUploading||uploadState.error||uploadState.success)&&/*#__PURE__*/_jsx(\"div\",{className:\"upload-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"upload-modal\",children:[uploadState.isUploading&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Processing File...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please wait while we process your transaction file.\"})]}),uploadState.error&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"error-icon\",children:\"\\u274C\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Upload Error\"}),/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:uploadState.error}),uploadState.errors&&Object.keys(uploadState.errors).length>0&&(()=>{// Aggregate all errors across rows and deduplicate\nconst allErrors=new Set();const structuralErrors=[];Object.entries(uploadState.errors).forEach(_ref=>{let[key,messages]=_ref;const messageArray=Array.isArray(messages)?messages:[messages];// Separate structural errors (like missing columns) from row errors\nif(key==='structure'||key==='general'){structuralErrors.push(...messageArray);}else{// Add row-specific errors to the set (automatically deduplicates)\nmessageArray.forEach(msg=>allErrors.add(msg));}});const uniqueErrors=[...allErrors];return/*#__PURE__*/_jsxs(\"div\",{className:\"error-details\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Validation Errors:\"}),structuralErrors.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"structural-errors\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File Structure Issues:\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"error-list\",children:structuralErrors.map((error,idx)=>/*#__PURE__*/_jsx(\"li\",{children:error},idx))})]}),uniqueErrors.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"data-errors\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Data Validation Issues:\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"error-list\",children:uniqueErrors.map((error,idx)=>/*#__PURE__*/_jsx(\"li\",{children:error},idx))})]})]});})(),/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",onClick:()=>setUploadState({isUploading:false,error:null,errors:{},success:false}),children:\"Close\"})]}),uploadState.success&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"success-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"File Processed Successfully!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Your transactions have been imported and calculated.\"})]})]})}),/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"logo\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo-icon\",children:/*#__PURE__*/_jsxs(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"rect\",{x:\"3\",y:\"3\",width:\"18\",height:\"18\",rx:\"2\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M8 8h8M8 12h8M8 16h5\",stroke:\"#1a1f2e\",strokeWidth:\"2\",strokeLinecap:\"round\"})]})}),/*#__PURE__*/_jsx(\"span\",{className:\"logo-text\",children:\"TaxTim\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-box\",children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"11\",cy:\"11\",r:\"8\",stroke:\"currentColor\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M21 21l-4.35-4.35\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-status\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"upload-icon\",children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M12 15V3m0 0L8 7m4-4l4 4M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkmark\",children:\"\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{children:\"crypto_transactions_20...\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"upload-btn\",onClick:handleUploadClick,children:\"Upload / calculate\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Filters\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Asset\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"filter-select\",value:filters.asset,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{asset:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Assets\"}),currencies.map(currency=>/*#__PURE__*/_jsx(\"option\",{value:currency,children:currency},currency))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Transaction Type\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"filter-checkbox\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:filters.type==='all'||filters.type==='BUY',onChange:()=>setFilters(_objectSpread(_objectSpread({},filters),{},{type:filters.type==='BUY'?'all':'BUY'}))}),/*#__PURE__*/_jsx(\"span\",{children:\"Buy\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"filter-checkbox\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:filters.type==='all'||filters.type==='SELL',onChange:()=>setFilters(_objectSpread(_objectSpread({},filters),{},{type:filters.type==='SELL'?'all':'SELL'}))}),/*#__PURE__*/_jsx(\"span\",{children:\"Sell\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"filter-checkbox\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:filters.type==='all'||filters.type==='TRADE',onChange:()=>setFilters(_objectSpread(_objectSpread({},filters),{},{type:filters.type==='TRADE'?'all':'TRADE'}))}),/*#__PURE__*/_jsx(\"span\",{children:\"Trade\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"reset-filters-btn\",onClick:handleResetFilters,children:\"Reset Filters\"}),data&&data.transactions&&data.transactions.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-downloads\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"sidebar-download-btn sidebar-download-pdf\",onClick:handlePDFDownload,disabled:isGeneratingPDF,children:isGeneratingPDF?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner-small\"}),\"Generating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M7 18H17V16H7V18Z\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M17 14H7V12H17V14Z\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M7 10H11V8H7V10Z\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",clipRule:\"evenodd\",d:\"M6 2C4.34315 2 3 3.34315 3 5V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V9C21 5.13401 17.866 2 14 2H6ZM6 4H13V9H19V19C19 19.5523 18.5523 20 18 20H6C5.44772 20 5 19.5523 5 19V5C5 4.44772 5.44772 4 6 4ZM15 4.10002C16.6113 4.4271 17.9413 5.52906 18.584 7H15V4.10002Z\",fill:\"currentColor\"})]}),\"Download PDF\"]})}),/*#__PURE__*/_jsx(\"button\",{className:\"sidebar-download-btn sidebar-download-excel\",onClick:handleExcelDownload,disabled:isGeneratingExcel,children:isGeneratingExcel?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner-small\"}),\"Generating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z\",fill:\"currentColor\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M8 15.5L10 18L12 15.5\",stroke:\"currentColor\",strokeWidth:\"1.5\",strokeLinecap:\"round\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M12 12L14 14.5L16 12\",stroke:\"currentColor\",strokeWidth:\"1.5\",strokeLinecap:\"round\"})]}),\"Download Excel\"]})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"add-file-section\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"add-file-btn\",onClick:handleUploadClick,children:[/*#__PURE__*/_jsx(\"span\",{children:\"+\"}),\" Add new file\"]})})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"main-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Crypto Tax Dashboard\"}),/*#__PURE__*/_jsx(\"p\",{className:\"date-range\",children:\"SARS-Ready Capital Gains Report\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"restart-btn\",onClick:handleRestart,title:\"Clear data and restart\",children:\"Restart\"})]}),hasTransactions&&/*#__PURE__*/_jsx(SuspiciousTransactionSummary,{redFlags:(data===null||data===void 0?void 0:data.red_flags)||[],summary:(data===null||data===void 0?void 0:data.red_flag_summary)||{total_flags:0,critical_count:0,high_count:0,medium_count:0,low_count:0,audit_risk_score:0,audit_risk_level:'MINIMAL'}}),hasTransactions&&/*#__PURE__*/_jsx(TaxStatusSummary,{taxStatus:(data===null||data===void 0?void 0:data.tax_status)||{non_taxable_events:[],taxable_events:[],summary:{total_events:0,non_taxable_count:0,taxable_count:0,buy_count:0,transfer_count:0,sell_count:0,trade_count:0},tax_obligation_exists:false}}),!hasTransactions?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-dashboard-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-state-icon\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"No Transaction Data\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Upload and process a transaction file to view your tax summary and analytics.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"upload-cta-btn\",onClick:handleUploadClick,children:\"Upload Transaction File\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SummaryCards,{summary:filteredSummary,taxYears:taxYears,selectedTaxYear:filters.taxYear,onTaxYearChange:year=>setFilters(_objectSpread(_objectSpread({},filters),{},{taxYear:year}))}),/*#__PURE__*/_jsx(Charts,{transactions:transactions,summary:unfilteredSummary}),/*#__PURE__*/_jsx(FilterPanel,{filters:filters,onFilterChange:handleFilterChange,assets:assets,taxYears:taxYears}),/*#__PURE__*/_jsx(TransactionTableEnhanced,{transactions:filteredTransactions}),/*#__PURE__*/_jsx(ExportButtons,{transactions:filteredTransactions,summary:filteredSummary,filters:filters})]})]})]});};export default LandingPage;","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","useNavigate","useLocation","BarChart","Bar","XAxis","YAxis","CartesianGrid","Tooltip","ResponsiveContainer","PieChart","Pie","Cell","getTransactionData","uploadTransactionFile","generatePDF","generateExcel","SummaryCards","TransactionTableEnhanced","Charts","FilterPanel","ExportButtons","SuspiciousTransactionSummary","TaxStatusSummary","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LandingPage","navigate","location","fileInputRef","searchTerm","setSearchTerm","loading","setLoading","data","setData","filters","setFilters","asset","type","taxYear","uploadState","setUploadState","isUploading","error","errors","success","isGeneratingPDF","setIsGeneratingPDF","isGeneratingExcel","setIsGeneratingExcel","clearCacheAndFetch","_location$state","state","fromProcessing","fetch","method","err","console","fetchData","response","result","json","transactions","analytics","fifo_breakdowns","enrichedTransactions","map","tx","index","breakdown","primaryCurrency","txType","toUpperCase","currency","toCurrency","fromCurrency","_objectSpread","amount","toAmount","fromAmount","capitalGain","proceeds","costBase","lotsConsumed","filteredTransactions","filter","search","toLowerCase","txString","JSON","stringify","includes","filterType","calculateTaxableGain","netGain","taxable","exclusionApplied","exclusionUsed","ANNUAL_EXCLUSION","INCLUSION_RATE","afterExclusion","filteredSummary","taxCalc","capital_gain","totalProceeds","total_proceeds","totalCostBase","total_cost_base","totalCapitalGain","total_capital_gain","totalCapitalLoss","total_capital_loss","netCapitalGain","taxableCapitalGain","annualExclusionApplied","annualExclusionUsed","transactionsProcessed","transactions_processed","length","summary","reduce","acc","gain","Math","abs","unfilteredSummary","taxYears","years","Set","forEach","add","Array","from","sort","assets","assetSet","handleFilterChange","newFilters","currencies","hasTransactions","handleUploadClick","current","click","handleFileChange","e","_e$target$files","file","target","files","validTypes","name","endsWith","setTimeout","prev","value","handleResetFilters","handlePDFDownload","alert","handleExcelDownload","handleRestart","sessionStorage","removeItem","window","reload","className","children","ref","accept","onChange","style","display","Object","keys","allErrors","structuralErrors","entries","_ref","key","messages","messageArray","isArray","push","msg","uniqueErrors","idx","onClick","width","height","viewBox","fill","xmlns","x","y","rx","d","stroke","strokeWidth","strokeLinecap","cx","cy","r","placeholder","strokeLinejoin","checked","disabled","fillRule","clipRule","title","redFlags","red_flags","red_flag_summary","total_flags","critical_count","high_count","medium_count","low_count","audit_risk_score","audit_risk_level","taxStatus","tax_status","non_taxable_events","taxable_events","total_events","non_taxable_count","taxable_count","buy_count","transfer_count","sell_count","trade_count","tax_obligation_exists","selectedTaxYear","onTaxYearChange","year","onFilterChange"],"sources":["C:/Users/Baloyi PA/Desktop/TaxTim-Team-6-New/TaxTim-Team-6-New/frontend/src/components/LandingPage.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';\r\nimport { getTransactionData, uploadTransactionFile } from '../services/api';\r\nimport { generatePDF } from '../services/pdfGenerator';\r\nimport { generateExcel } from '../services/excelGenerator';\r\nimport './LandingPage.css';\r\nimport './Dashboard.css';\r\nimport SummaryCards from './SummaryCards';\r\nimport TransactionTableEnhanced from './TransactionTableEnhanced';\r\nimport Charts from './Charts';\r\nimport FilterPanel from './FilterPanel';\r\nimport ExportButtons from './ExportButtons';\r\nimport SuspiciousTransactionSummary from './SuspiciousTransactionSummary';\r\nimport TaxStatusSummary from './TaxStatusSummary';\r\n\r\nconst LandingPage = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const fileInputRef = useRef(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [data, setData] = useState(null);\r\n  const [filters, setFilters] = useState({\r\n    asset: 'all',\r\n    type: 'all',\r\n    taxYear: 'all'\r\n  });\r\n  const [uploadState, setUploadState] = useState({\r\n    isUploading: false,\r\n    error: null,\r\n    errors: {},\r\n    success: false\r\n  });\r\n  const [isGeneratingPDF, setIsGeneratingPDF] = useState(false);\r\n  const [isGeneratingExcel, setIsGeneratingExcel] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Clear cache on initial page load (not on navigation)\r\n    const clearCacheAndFetch = async () => {\r\n      if (!location.state?.fromProcessing) {\r\n        try {\r\n          await fetch('http://localhost:8000/clear_cache.php', { method: 'POST' });\r\n        } catch (err) {\r\n          console.error('Error clearing cache:', err);\r\n        }\r\n      }\r\n      fetchData();\r\n    };\r\n    \r\n    clearCacheAndFetch();\r\n  }, [location]); // Refetch when location changes (e.g., navigating back)\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch('http://localhost:8000/transactions.php');\r\n      const result = await response.json();\r\n      \r\n      if (result.success) {\r\n        // Enrich transactions with FIFO breakdown data\r\n        if (result.data.transactions && result.data.analytics && result.data.analytics.fifo_breakdowns) {\r\n          const enrichedTransactions = result.data.transactions.map((tx, index) => {\r\n            const breakdown = result.data.analytics.fifo_breakdowns[index];\r\n            \r\n            // Determine the primary currency based on transaction type\r\n            let primaryCurrency;\r\n            const txType = (tx.type || '').toUpperCase();\r\n            if (txType === 'BUY') {\r\n              primaryCurrency = breakdown?.currency || tx.toCurrency;\r\n            } else if (txType === 'SELL') {\r\n              primaryCurrency = breakdown?.currency || tx.fromCurrency;\r\n            } else if (txType === 'TRADE') {\r\n              primaryCurrency = breakdown?.fromCurrency || tx.fromCurrency;\r\n            } else {\r\n              primaryCurrency = breakdown?.currency || tx.toCurrency || tx.fromCurrency;\r\n            }\r\n            \r\n            return {\r\n              ...tx,\r\n              currency: primaryCurrency,\r\n              amount: breakdown?.amount || tx.toAmount || tx.fromAmount || 0,\r\n              capitalGain: breakdown?.capitalGain || 0,\r\n              proceeds: breakdown?.proceeds || 0,\r\n              costBase: breakdown?.costBase || 0,\r\n              taxYear: breakdown?.taxYear || null,\r\n              lotsConsumed: breakdown?.lotsConsumed || null\r\n            };\r\n          });\r\n          result.data.transactions = enrichedTransactions;\r\n        }\r\n        \r\n        setData(result.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching data:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const transactions = data?.transactions || [];\r\n  \r\n  // Filter transactions based on dashboard filters\r\n  const filteredTransactions = useMemo(() => {\r\n    if (!data || !data.transactions) return [];\r\n\r\n    return data.transactions.filter(tx => {\r\n      // Search filter\r\n      if (searchTerm) {\r\n        const search = searchTerm.toLowerCase();\r\n        const txString = JSON.stringify(tx).toLowerCase();\r\n        if (!txString.includes(search)) return false;\r\n      }\r\n\r\n      // Filter by asset\r\n      if (filters.asset !== 'all') {\r\n        if (tx.currency !== filters.asset) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      // Filter by type\r\n      if (filters.type !== 'all') {\r\n        const txType = (tx.type || '').toUpperCase();\r\n        const filterType = (filters.type || '').toUpperCase();\r\n        if (txType !== filterType) return false;\r\n      }\r\n\r\n      // Filter by tax year\r\n      if (filters.taxYear !== 'all' && tx.taxYear !== filters.taxYear) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [data, filters, searchTerm]);\r\n\r\n  // Helper function to calculate taxable gain with annual exclusion\r\n  const calculateTaxableGain = (netGain) => {\r\n    if (netGain <= 0) return { taxable: 0, exclusionApplied: 0, exclusionUsed: false };\r\n    \r\n    const ANNUAL_EXCLUSION = 40000;\r\n    const INCLUSION_RATE = 0.4;\r\n    \r\n    if (netGain > ANNUAL_EXCLUSION) {\r\n      const afterExclusion = netGain - ANNUAL_EXCLUSION;\r\n      return {\r\n        taxable: afterExclusion * INCLUSION_RATE,\r\n        exclusionApplied: ANNUAL_EXCLUSION,\r\n        exclusionUsed: true\r\n      };\r\n    } else {\r\n      return {\r\n        taxable: 0,\r\n        exclusionApplied: netGain,\r\n        exclusionUsed: true\r\n      };\r\n    }\r\n  };\r\n\r\n  // Calculate filtered summary\r\n  const filteredSummary = useMemo(() => {\r\n    // Use analytics data from backend if available\r\n    if (data && data.analytics) {\r\n      const taxCalc = calculateTaxableGain(data.analytics.capital_gain || 0);\r\n      return {\r\n        totalProceeds: data.analytics.total_proceeds || 0,\r\n        totalCostBase: data.analytics.total_cost_base || 0,\r\n        totalCapitalGain: data.analytics.total_capital_gain || 0,\r\n        totalCapitalLoss: data.analytics.total_capital_loss || 0,\r\n        netCapitalGain: data.analytics.capital_gain || 0,\r\n        taxableCapitalGain: taxCalc.taxable,\r\n        annualExclusionApplied: taxCalc.exclusionApplied,\r\n        annualExclusionUsed: taxCalc.exclusionUsed,\r\n        transactionsProcessed: data.analytics.transactions_processed || 0\r\n      };\r\n    }\r\n\r\n    if (!filteredTransactions.length) {\r\n      return {\r\n        totalProceeds: 0,\r\n        totalCostBase: 0,\r\n        totalCapitalGain: 0,\r\n        totalCapitalLoss: 0,\r\n        netCapitalGain: 0,\r\n        taxableCapitalGain: 0,\r\n        annualExclusionApplied: 0,\r\n        annualExclusionUsed: false,\r\n        transactionsProcessed: 0\r\n      };\r\n    }\r\n\r\n    const summary = filteredTransactions.reduce((acc, tx) => {\r\n      if (tx.type === 'SELL' || tx.type === 'TRADE_SELL') {\r\n        acc.totalProceeds += tx.proceeds || 0;\r\n        acc.totalCostBase += tx.costBase || 0;\r\n        \r\n        const gain = tx.capitalGain || 0;\r\n        if (gain >= 0) {\r\n          acc.totalCapitalGain += gain;\r\n        } else {\r\n          acc.totalCapitalLoss += Math.abs(gain);\r\n        }\r\n        acc.netCapitalGain += gain;\r\n      }\r\n      acc.transactionsProcessed++;\r\n      return acc;\r\n    }, {\r\n      totalProceeds: 0,\r\n      totalCostBase: 0,\r\n      totalCapitalGain: 0,\r\n      totalCapitalLoss: 0,\r\n      netCapitalGain: 0,\r\n      transactionsProcessed: 0\r\n    });\r\n\r\n    const taxCalc = calculateTaxableGain(summary.netCapitalGain);\r\n    summary.taxableCapitalGain = taxCalc.taxable;\r\n    summary.annualExclusionApplied = taxCalc.exclusionApplied;\r\n    summary.annualExclusionUsed = taxCalc.exclusionUsed;\r\n\r\n    return summary;\r\n  }, [data, filteredTransactions]);\r\n\r\n  // Calculate unfiltered summary for charts (all assets, all transactions)\r\n  const unfilteredSummary = useMemo(() => {\r\n    // Use analytics data from backend if available\r\n    if (data && data.analytics) {\r\n      const taxCalc = calculateTaxableGain(data.analytics.capital_gain || 0);\r\n      return {\r\n        totalProceeds: data.analytics.total_proceeds || 0,\r\n        totalCostBase: data.analytics.total_cost_base || 0,\r\n        totalCapitalGain: data.analytics.total_capital_gain || 0,\r\n        totalCapitalLoss: data.analytics.total_capital_loss || 0,\r\n        netCapitalGain: data.analytics.capital_gain || 0,\r\n        taxableCapitalGain: taxCalc.taxable,\r\n        annualExclusionApplied: taxCalc.exclusionApplied,\r\n        annualExclusionUsed: taxCalc.exclusionUsed,\r\n        transactionsProcessed: data.analytics.transactions_processed || 0\r\n      };\r\n    }\r\n\r\n    if (!transactions.length) {\r\n      return {\r\n        totalProceeds: 0,\r\n        totalCostBase: 0,\r\n        totalCapitalGain: 0,\r\n        totalCapitalLoss: 0,\r\n        netCapitalGain: 0,\r\n        taxableCapitalGain: 0,\r\n        annualExclusionApplied: 0,\r\n        annualExclusionUsed: false,\r\n        transactionsProcessed: 0\r\n      };\r\n    }\r\n\r\n    const summary = transactions.reduce((acc, tx) => {\r\n      if (tx.type === 'SELL' || tx.type === 'TRADE_SELL') {\r\n        acc.totalProceeds += tx.proceeds || 0;\r\n        acc.totalCostBase += tx.costBase || 0;\r\n        \r\n        const gain = tx.capitalGain || 0;\r\n        if (gain >= 0) {\r\n          acc.totalCapitalGain += gain;\r\n        } else {\r\n          acc.totalCapitalLoss += Math.abs(gain);\r\n        }\r\n        acc.netCapitalGain += gain;\r\n      }\r\n      acc.transactionsProcessed++;\r\n      return acc;\r\n    }, {\r\n      totalProceeds: 0,\r\n      totalCostBase: 0,\r\n      totalCapitalGain: 0,\r\n      totalCapitalLoss: 0,\r\n      netCapitalGain: 0,\r\n      transactionsProcessed: 0\r\n    });\r\n\r\n    const taxCalc = calculateTaxableGain(summary.netCapitalGain);\r\n    summary.taxableCapitalGain = taxCalc.taxable;\r\n    summary.annualExclusionApplied = taxCalc.exclusionApplied;\r\n    summary.annualExclusionUsed = taxCalc.exclusionUsed;\r\n\r\n    return summary;\r\n  }, [data, transactions]);\r\n\r\n  // Extract unique tax years from data\r\n  const taxYears = useMemo(() => {\r\n    if (!data || !data.transactions) return [];\r\n    \r\n    const years = new Set();\r\n    data.transactions.forEach(tx => {\r\n      if (tx.taxYear) years.add(tx.taxYear);\r\n    });\r\n    \r\n    return Array.from(years).sort();\r\n  }, [data]);\r\n\r\n  // Extract unique assets\r\n  const assets = useMemo(() => {\r\n    if (!data || !data.transactions) return [];\r\n    \r\n    const assetSet = new Set();\r\n    data.transactions.forEach(tx => {\r\n      if (tx.currency) assetSet.add(tx.currency);\r\n      if (tx.fromCurrency) assetSet.add(tx.fromCurrency);\r\n      if (tx.toCurrency) assetSet.add(tx.toCurrency);\r\n    });\r\n    \r\n    return Array.from(assetSet).sort();\r\n  }, [data]);\r\n  \r\n  const handleFilterChange = (newFilters) => {\r\n    setFilters(newFilters);\r\n  };\r\n  \r\n  // Get unique currencies for filter dropdown (for sidebar)\r\n  const currencies = assets;\r\n\r\n  // Check if we have any transactions\r\n  const hasTransactions = data && data.transactions && data.transactions.length > 0;\r\n\r\n  const handleUploadClick = () => {\r\n    // Trigger file input click instead of navigating\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.click();\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (e) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const validTypes = [\r\n      'text/csv',\r\n      'application/vnd.ms-excel',\r\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\r\n    ];\r\n    \r\n    if (!validTypes.includes(file.type) && \r\n        !file.name.endsWith('.csv') && \r\n        !file.name.endsWith('.xlsx') && \r\n        !file.name.endsWith('.xls')) {\r\n      setUploadState({\r\n        isUploading: false,\r\n        error: 'Please upload a CSV or XLSX file',\r\n        errors: {},\r\n        success: false\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Start upload\r\n    setUploadState({\r\n      isUploading: true,\r\n      error: null,\r\n      errors: {},\r\n      success: false\r\n    });\r\n\r\n    try {\r\n      const response = await uploadTransactionFile(file);\r\n      \r\n      if (response.success) {\r\n        // Keep showing the processing message for 1.5 seconds before showing success\r\n        setTimeout(async () => {\r\n          setUploadState({\r\n            isUploading: false,\r\n            error: null,\r\n            errors: {},\r\n            success: true\r\n          });\r\n          // Refresh data after successful upload\r\n          await fetchData();\r\n          // Clear success message after 3 seconds\r\n          setTimeout(() => {\r\n            setUploadState(prev => ({ ...prev, success: false }));\r\n          }, 3000);\r\n        }, 1500);\r\n      } else {\r\n        setUploadState({\r\n          isUploading: false,\r\n          error: response.error || 'An error occurred during upload',\r\n          errors: response.errors || {},\r\n          success: false\r\n        });\r\n      }\r\n    } catch (err) {\r\n      setUploadState({\r\n        isUploading: false,\r\n        error: err.error || 'Failed to process file',\r\n        errors: err.errors || {},\r\n        success: false\r\n      });\r\n    }\r\n\r\n    // Reset file input\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  const handleResetFilters = () => {\r\n    setFilters({\r\n      asset: 'all',\r\n      type: 'all',\r\n      taxYear: 'all'\r\n    });\r\n    setSearchTerm('');\r\n  };\r\n\r\n  const handlePDFDownload = async () => {\r\n    setIsGeneratingPDF(true);\r\n    try {\r\n      await generatePDF(filteredTransactions, filteredSummary, filters);\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      alert('Failed to generate PDF. Please try again.');\r\n    } finally {\r\n      setIsGeneratingPDF(false);\r\n    }\r\n  };\r\n\r\n  const handleExcelDownload = async () => {\r\n    setIsGeneratingExcel(true);\r\n    try {\r\n      await generateExcel(filteredTransactions, filteredSummary, filters);\r\n    } catch (error) {\r\n      console.error('Error generating Excel:', error);\r\n      alert('Failed to generate Excel file. Please try again.');\r\n    } finally {\r\n      setIsGeneratingExcel(false);\r\n    }\r\n  };\r\n\r\n  const handleRestart = async () => {\r\n    try {\r\n      // Clear the cache\r\n      await fetch('http://localhost:8000/clear_cache.php', { method: 'POST' });\r\n      // Clear session storage\r\n      sessionStorage.removeItem('justProcessedFile');\r\n      // Reload the page\r\n      window.location.reload();\r\n    } catch (err) {\r\n      console.error('Error restarting:', err);\r\n      // Reload anyway\r\n      window.location.reload();\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"landing-page\">\r\n        <div className=\"loading-container\">\r\n          <div className=\"spinner\"></div>\r\n          <p>Loading dashboard...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"landing-page\">\r\n      {/* Hidden file input */}\r\n      <input\r\n        ref={fileInputRef}\r\n        type=\"file\"\r\n        accept=\".csv,.xlsx,.xls\"\r\n        onChange={handleFileChange}\r\n        style={{ display: 'none' }}\r\n      />\r\n\r\n      {/* Upload Modal/Overlay */}\r\n      {(uploadState.isUploading || uploadState.error || uploadState.success) && (\r\n        <div className=\"upload-overlay\">\r\n          <div className=\"upload-modal\">\r\n            {uploadState.isUploading && (\r\n              <>\r\n                <div className=\"spinner\"></div>\r\n                <h3>Processing File...</h3>\r\n                <p>Please wait while we process your transaction file.</p>\r\n              </>\r\n            )}\r\n            {uploadState.error && (\r\n              <>\r\n                <div className=\"error-icon\">❌</div>\r\n                <h3>Upload Error</h3>\r\n                <p className=\"error-message\">{uploadState.error}</p>\r\n                {uploadState.errors && Object.keys(uploadState.errors).length > 0 && (() => {\r\n                  // Aggregate all errors across rows and deduplicate\r\n                  const allErrors = new Set();\r\n                  const structuralErrors = [];\r\n                  \r\n                  Object.entries(uploadState.errors).forEach(([key, messages]) => {\r\n                    const messageArray = Array.isArray(messages) ? messages : [messages];\r\n                    \r\n                    // Separate structural errors (like missing columns) from row errors\r\n                    if (key === 'structure' || key === 'general') {\r\n                      structuralErrors.push(...messageArray);\r\n                    } else {\r\n                      // Add row-specific errors to the set (automatically deduplicates)\r\n                      messageArray.forEach(msg => allErrors.add(msg));\r\n                    }\r\n                  });\r\n                  \r\n                  const uniqueErrors = [...allErrors];\r\n                  \r\n                  return (\r\n                    <div className=\"error-details\">\r\n                      <h4>Validation Errors:</h4>\r\n                      {structuralErrors.length > 0 && (\r\n                        <div className=\"structural-errors\">\r\n                          <strong>File Structure Issues:</strong>\r\n                          <ul className=\"error-list\">\r\n                            {structuralErrors.map((error, idx) => (\r\n                              <li key={idx}>{error}</li>\r\n                            ))}\r\n                          </ul>\r\n                        </div>\r\n                      )}\r\n                      {uniqueErrors.length > 0 && (\r\n                        <div className=\"data-errors\">\r\n                          <strong>Data Validation Issues:</strong>\r\n                          <ul className=\"error-list\">\r\n                            {uniqueErrors.map((error, idx) => (\r\n                              <li key={idx}>{error}</li>\r\n                            ))}\r\n                          </ul>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })()}\r\n                <button \r\n                  className=\"btn-primary\" \r\n                  onClick={() => setUploadState({ isUploading: false, error: null, errors: {}, success: false })}\r\n                >\r\n                  Close\r\n                </button>\r\n              </>\r\n            )}\r\n            {uploadState.success && (\r\n              <>\r\n                <div className=\"success-icon\">✅</div>\r\n                <h3>File Processed Successfully!</h3>\r\n                <p>Your transactions have been imported and calculated.</p>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Sidebar */}\r\n      <aside className=\"sidebar\">\r\n        <div className=\"logo\">\r\n          <div className=\"logo-icon\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" fill=\"currentColor\"/>\r\n              <path d=\"M8 8h8M8 12h8M8 16h5\" stroke=\"#1a1f2e\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n            </svg>\r\n          </div>\r\n          <span className=\"logo-text\">TaxTim</span>\r\n        </div>\r\n\r\n        <div className=\"search-box\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <circle cx=\"11\" cy=\"11\" r=\"8\" stroke=\"currentColor\" strokeWidth=\"2\"/>\r\n            <path d=\"M21 21l-4.35-4.35\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n          </svg>\r\n          <input \r\n            type=\"text\" \r\n            placeholder=\"Search...\" \r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"upload-section\">\r\n          <div className=\"file-status\">\r\n            <div className=\"upload-icon\">\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 15V3m0 0L8 7m4-4l4 4M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n              </svg>\r\n            </div>\r\n            <div className=\"file-info\">\r\n              <div className=\"checkmark\">✓</div>\r\n              <span>crypto_transactions_20...</span>\r\n            </div>\r\n          </div>\r\n          <button className=\"upload-btn\" onClick={handleUploadClick}>\r\n            Upload / calculate\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"filters-section\">\r\n          <h3>Filters</h3>\r\n          \r\n          <div className=\"filter-group\">\r\n            <h4>Asset</h4>\r\n            <select \r\n              className=\"filter-select\"\r\n              value={filters.asset}\r\n              onChange={(e) => setFilters({...filters, asset: e.target.value})}\r\n            >\r\n              <option value=\"all\">All Assets</option>\r\n              {currencies.map(currency => (\r\n                <option key={currency} value={currency}>{currency}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"filter-group\">\r\n            <h4>Transaction Type</h4>\r\n            <label className=\"filter-checkbox\">\r\n              <input \r\n                type=\"checkbox\" \r\n                checked={filters.type === 'all' || filters.type === 'BUY'}\r\n                onChange={() => setFilters({...filters, type: filters.type === 'BUY' ? 'all' : 'BUY'})}\r\n              />\r\n              <span>Buy</span>\r\n            </label>\r\n            <label className=\"filter-checkbox\">\r\n              <input \r\n                type=\"checkbox\" \r\n                checked={filters.type === 'all' || filters.type === 'SELL'}\r\n                onChange={() => setFilters({...filters, type: filters.type === 'SELL' ? 'all' : 'SELL'})}\r\n              />\r\n              <span>Sell</span>\r\n            </label>\r\n            <label className=\"filter-checkbox\">\r\n              <input \r\n                type=\"checkbox\" \r\n                checked={filters.type === 'all' || filters.type === 'TRADE'}\r\n                onChange={() => setFilters({...filters, type: filters.type === 'TRADE' ? 'all' : 'TRADE'})}\r\n              />\r\n              <span>Trade</span>\r\n            </label>\r\n          </div>\r\n\r\n          <button className=\"reset-filters-btn\" onClick={handleResetFilters}>\r\n            Reset Filters\r\n          </button>\r\n\r\n          {/* Download Buttons - Show only when data is loaded */}\r\n          {data && data.transactions && data.transactions.length > 0 && (\r\n            <div className=\"sidebar-downloads\">\r\n              <button \r\n                className=\"sidebar-download-btn sidebar-download-pdf\" \r\n                onClick={handlePDFDownload}\r\n                disabled={isGeneratingPDF}\r\n              >\r\n                {isGeneratingPDF ? (\r\n                  <>\r\n                    <span className=\"spinner-small\"></span>\r\n                    Generating...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                      <path d=\"M7 18H17V16H7V18Z\" fill=\"currentColor\"/>\r\n                      <path d=\"M17 14H7V12H17V14Z\" fill=\"currentColor\"/>\r\n                      <path d=\"M7 10H11V8H7V10Z\" fill=\"currentColor\"/>\r\n                      <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M6 2C4.34315 2 3 3.34315 3 5V19C3 20.6569 4.34315 22 6 22H18C19.6569 22 21 20.6569 21 19V9C21 5.13401 17.866 2 14 2H6ZM6 4H13V9H19V19C19 19.5523 18.5523 20 18 20H6C5.44772 20 5 19.5523 5 19V5C5 4.44772 5.44772 4 6 4ZM15 4.10002C16.6113 4.4271 17.9413 5.52906 18.584 7H15V4.10002Z\" fill=\"currentColor\"/>\r\n                    </svg>\r\n                    Download PDF\r\n                  </>\r\n                )}\r\n              </button>\r\n              \r\n              <button \r\n                className=\"sidebar-download-btn sidebar-download-excel\" \r\n                onClick={handleExcelDownload}\r\n                disabled={isGeneratingExcel}\r\n              >\r\n                {isGeneratingExcel ? (\r\n                  <>\r\n                    <span className=\"spinner-small\"></span>\r\n                    Generating...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                      <path d=\"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z\" fill=\"currentColor\"/>\r\n                      <path d=\"M8 15.5L10 18L12 15.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\r\n                      <path d=\"M12 12L14 14.5L16 12\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\r\n                    </svg>\r\n                    Download Excel\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"add-file-section\">\r\n          <button className=\"add-file-btn\" onClick={handleUploadClick}>\r\n            <span>+</span> Add new file\r\n          </button>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Main Content */}\r\n      <main className=\"main-content\">\r\n        <div className=\"dashboard-header\">\r\n          <div className=\"dashboard-title\">\r\n            <h1>Crypto Tax Dashboard</h1>\r\n            <p className=\"date-range\">SARS-Ready Capital Gains Report</p>\r\n          </div>\r\n          <button className=\"restart-btn\" onClick={handleRestart} title=\"Clear data and restart\">\r\n            Restart\r\n          </button>\r\n        </div>\r\n\r\n        {/* Red Flag Summary - Always shown when we have transaction data */}\r\n        {hasTransactions && (\r\n          <SuspiciousTransactionSummary \r\n            redFlags={data?.red_flags || []}\r\n            summary={data?.red_flag_summary || {\r\n              total_flags: 0,\r\n              critical_count: 0,\r\n              high_count: 0,\r\n              medium_count: 0,\r\n              low_count: 0,\r\n              audit_risk_score: 0,\r\n              audit_risk_level: 'MINIMAL'\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Tax Status Summary - Always shown when we have transaction data */}\r\n        {hasTransactions && (\r\n          <TaxStatusSummary \r\n            taxStatus={data?.tax_status || {\r\n              non_taxable_events: [],\r\n              taxable_events: [],\r\n              summary: {\r\n                total_events: 0,\r\n                non_taxable_count: 0,\r\n                taxable_count: 0,\r\n                buy_count: 0,\r\n                transfer_count: 0,\r\n                sell_count: 0,\r\n                trade_count: 0\r\n              },\r\n              tax_obligation_exists: false\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Summary Cards or Empty State */}\r\n        {!hasTransactions ? (\r\n          <div className=\"empty-dashboard-state\">\r\n            <div className=\"empty-state-icon\"></div>\r\n            <h2>No Transaction Data</h2>\r\n            <p>Upload and process a transaction file to view your tax summary and analytics.</p>\r\n            <button className=\"upload-cta-btn\" onClick={handleUploadClick}>\r\n              Upload Transaction File\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <SummaryCards \r\n              summary={filteredSummary} \r\n              taxYears={taxYears}\r\n              selectedTaxYear={filters.taxYear}\r\n              onTaxYearChange={(year) => setFilters({...filters, taxYear: year})}\r\n            />\r\n\r\n            {/* Charts Section */}\r\n            <Charts \r\n              transactions={transactions}\r\n              summary={unfilteredSummary}\r\n            />\r\n\r\n            {/* Filter Panel */}\r\n            <FilterPanel\r\n              filters={filters}\r\n              onFilterChange={handleFilterChange}\r\n              assets={assets}\r\n              taxYears={taxYears}\r\n            />\r\n\r\n            {/* Enhanced Transaction Table with FIFO Details */}\r\n            <TransactionTableEnhanced \r\n              transactions={filteredTransactions}\r\n            />\r\n\r\n            {/* Export Buttons */}\r\n            <ExportButtons \r\n              transactions={filteredTransactions}\r\n              summary={filteredSummary}\r\n              filters={filters}\r\n            />\r\n          </>\r\n        )}\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LandingPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}